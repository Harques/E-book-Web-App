<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wuhan</title>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="/stylesheets/userAvailableBooks/css/styles.css">

</head>
<body>
  <div id="wrapper">
    <div class="overlay"></div>

    <!-- Sidebar -->
    <nav class="navbar navbar-inverse fixed-top" id="sidebar-wrapper" role="navigation">
      <ul class="nav sidebar-nav">
        <div class="sidebar-header">
        <div class="sidebar-brand">
          <a href="#">Wuhan</a></div></div>

        <li class="dropdown">
        <a href="#" class="dropdown-toggle"  data-toggle="dropdown">Library <span class="caret"></span></a>
      <ul class="dropdown-menu" role="menu" id="library">
       <div class="dropdown-header">Books</div>

       </ul>
       </li>
       <li class="dropdown">
        <a href="#" class="dropdown-toggle"  data-toggle="dropdown">Account <span class="caret"></span></a>
      <ul class="dropdown-menu" role="menu" id="credentials">
       <div class="dropdown-header">Credentials</div>

       </ul>
       </li>
       <li><a href="userAvailableBooks">Available Books</a></li>
       <li><a href="/">Logout</a></li>
       </ul>
   </nav>
    <!-- /#sidebar-wrapper -->

    <!-- Page Content -->
    <div id="page-content-wrapper">
        <button type="button" class="hamburger is-closed" data-toggle="offcanvas">
            <span class="hamb-top"></span>
      <span class="hamb-middle"></span>
    <span class="hamb-bottom"></span>
        </button>
        <div class="container text-center my-3">
          <div id="mainDiv" class="row mx-auto my-auto">
              <div id="recipeCarousel" class="carousel slide w-100" data-ride="carousel">
                <ul class="carousel-indicators"></ul>
                  <div id="bookCarousel" class="carousel-inner w-100" role="listbox">
                  </div>
                  <a id="prevButton" class="carousel-control-prev w-auto" href="#recipeCarousel" role="button" data-slide="prev">
                      <span class="carousel-control-prev-icon bg-dark border border-dark rounded-circle" aria-hidden="true"></span>
                      <span class="sr-only">Previous</span>
                  </a>
                  <a id="nextButton" class="carousel-control-next w-auto" href="#recipeCarousel" role="button" data-slide="next">
                      <span class="carousel-control-next-icon bg-dark border border-dark rounded-circle" aria-hidden="true"></span>
                      <span class="sr-only">Next</span>
                  </a>
              </div>
          </div>
          
    </div>
    </div>
    <!-- /#page-content-wrapper -->

</div>
<!-- /#wrapper -->

      
<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script>

<script>
  $(document).ready(function () {
  var trigger = $('.hamburger'),
      overlay = $('.overlay'),
     isClosed = false;

    trigger.click(function () {
      hamburger_cross();      
    });

    function hamburger_cross() {

      if (isClosed == true) {          
        overlay.hide();
        trigger.removeClass('is-open');
        trigger.addClass('is-closed');
        isClosed = false;
      } else {   
        overlay.show();
        trigger.removeClass('is-closed');
        trigger.addClass('is-open');
        isClosed = true;
      }
  }
  
  $('[data-toggle="offcanvas"]').click(function () {
        $('#wrapper').toggleClass('toggled');
  });  
});
</script>

<script>
  var userID = "<%= id %>";
        $.get("/library?uid="+ userID,function(data,status){
          for(i = 0; i<data.length;i++){
            $(document).ready(function(){
              var url = '/getBook?book=' + data[i][0] + '&uid='+ userID
              $("#library").append('<li><a class=\'books\' href='+ url +'>'+data[i][1]+"</a></li>")
            })
          }
        });
</script>
<script>
  var userID = "<%= id %>";
  $.get("/credentials?uid=" + userID,function(data,status){
      for(i = 0; i<data.length;i++){
        $(document).ready(function(){
          $("#credentials").append("<li><a href=\"#\">"+data[i].join("")+"</a></li>")
        })
      }
      $('#credentials').append("<li><a href=\"userEditAccount?uid="+ userID+"\">Edit Account Credentials</a></li>")
  });
</script>
<script>
  var userID = "<%= id %>";
  $('#availableBooks').attr("href", "/userAvailableBooks?uid=" + userID);
</script>
<script>
    var books = "<%= books %>";
    var booksArray = books.split(',');
    $(document).ready(function(){
        var bookCounter = 0;
        var myCarousel = $("#bookCarousel")
            for(i = 0; i< booksArray.length;i+=4){
                if(i==0)
                    myCarousel.append("<div class=\"carousel-item active\"><div class=\"col-md-4\"><div style=\"height:400px;\" class=\"card card-body\"><img loading=\"eager\" class=\"img-fluid\" src=\""+ booksArray[i+1]+"\"><br><h3>Title: "+booksArray[i+2] +"</h3><br><p>Description: "+booksArray[i]+"</p><div style=\"margin-top:1rem;\" id=\"smart-button-container\"><div style=\"text-align: center;\"><div id=\"paypal-button-container"+i/4+"\"></div></div></div></div></div></div></div>")
                else
                    myCarousel.append("<div class=\"carousel-item\"><div class=\"col-md-4\"><div style=\"height:400px;\" class=\"card card-body\"><img loading=\"eager\" class=\"img-fluid\" src=\""+ booksArray[i+1]+"\"><br><h3>Title: "+booksArray[i+2] +"</h3><br><p>Description: "+booksArray[i]+"</p><div style=\"margin-top:1rem;\" id=\"smart-button-container\"><div style=\"text-align: center;\"><div id=\"paypal-button-container"+i/4+"\"></div></div></div></div></div></div></div>")
                bookCounter++;
                    }


    });
</script>
<script>
  $('#recipeCarousel').carousel({
        interval: 10000
      })
$(document).ready(function(){
    var books = "<%= books %>";
    var booksArray = books.split(',');
    var counter = 0;
    $('.carousel .carousel-item').each(function(){
        counter++;
    });
    
    if(counter==0){
        var myCarousel = $('#bookCarousel')
        myCarousel.css('display','none');
        var mainDiv = $('#mainDiv')
        mainDiv.append("<h1>There are no books to be shown</h1>")
        var nextButton = $('#nextButton')
        var prevButton = $('#prevButton')
        nextButton.css('display','none')
        prevButton.css('display','none')
    }

    else if(counter == 1){
        var myCarousel = $("#bookCarousel")
        myCarousel.append("<div class=\"carousel-item\"><div class=\"col-md-4\"><div style=\"height:400px;\" class=\"card card-body\"><img loading=\"eager\" class=\"img-fluid\" src=\""+ booksArray[1]+"\"><br><h3>Title: "+booksArray[2] +"</h3><br><p>Description: "+booksArray[0]+"</p><div style=\"margin-top:1rem;\" id=\"smart-button-container\"><div style=\"text-align: center;\"><div id=\"paypal-button-container"+i/4+"\"></div></div></div></div></div></div>")
        $('.carousel .carousel-item').each(function(){
            for (i = 0; i<2; i++){
                $(this).children(':first-child').clone().appendTo($(this));
            }
      });
    }
    else if (counter == 2){
        forCounter = 0;
        $('.carousel .carousel-item').each(function(){
            if(counter == 0){
                var next = $(this).next()
                next.children(':first-child').clone().appendTo($(this))
                $(this).children(':first-child').clone().appendTo($(this))
                counter++;
            }
            else{
                var next = $(this).siblings(':first');
                next.children(':first-child').clone().appendTo($(this))
                $(this).children(':first-child').clone().appendTo($(this));
            }
      });

    }
    else if (counter > 2){
        $('.carousel .carousel-item').each(function(){
          var minPerSlide = 3;
          console.log("Bu" + this)
          var next = $(this).next();
          console.log("bir sonraki" + next)
          if (!next.length) {
              console.log("Length")
          next = $(this).siblings(':first');
          }
          next.children(':first-child').clone().appendTo($(this));
          
          for (var i=0;i<minPerSlide;i++) {
              next=next.next();
              if (!next.length) {
                  console.log("Buraya da girdi")
                next = $(this).siblings(':first');
              }
              
              next.children(':first-child').clone().appendTo($(this));
            }
      });
    }

});
</script>
<script src="https://www.paypal.com/sdk/js?client-id=sb&currency=USD" data-sdk-integration-source="button-factory"></script>
  <script>
        var books = "<%= books %>";
        var booksArray = books.split(',');
    function initPayPalButton() {
      for(i=0;i<booksArray.length/4;i++){
        var price = parseInt(booksArray[(i+1)*4])
        paypal.Buttons({
        style: {
          shape: 'rect',
          color: 'gold',
          layout: 'vertical',
          label: 'paypal',
          
        },

        createOrder: function(data, actions) {
          return actions.order.create({
            purchase_units: [{"amount":{"currency_code":"USD","value":price}}]
          });
        },

        onApprove: function(data, actions) {
          return actions.order.capture().then(function(details) {
            alert('Transaction completed by ' + details.payer.name.given_name + '!');
          });
        },

        onError: function(err) {
          console.log(err);
        }
      }).render('#paypal-button-container'+i);
    }
      }

    initPayPalButton();
  </script>
</body>
</html>
